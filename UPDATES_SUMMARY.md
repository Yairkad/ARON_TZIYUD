# ðŸ“‹ ×¡×™×›×•× ×¢×“×›×•× ×™× ××—×¨×•× ×™× - ×ž×¢×¨×›×ª ××¨×•×Ÿ ×¦×™×•×“ ×™×“×™×“×™×

×ª××¨×™×š: × ×•×‘×ž×‘×¨ 2024
×’×¨×¡×”: 3.0

## ðŸŽ¯ ×ª×›×•× ×•×ª ×—×“×©×•×ª ×¢×™×§×¨×™×•×ª

### 1. **×ž×¦×‘ ×‘×§×©×•×ª ×¢× ×˜×•×§× ×™× (Request Mode)** ðŸŽ«

#### ×ž×”×• ×ž×¦×‘ ×‘×§×©×•×ª?
×‘×ž×§×•× ×”×©××œ×” ×™×©×™×¨×”, ×›×¢×ª × ×™×ª×Ÿ ×œ×”×’×“×™×¨ ×©×”×¢×™×¨ ×ª×¢×‘×•×“ ×‘×ž×¦×‘ ×‘×§×©×•×ª. ×‘×ž×¦×‘ ×–×”:

**×–×¨×™×ž×ª ×¢×‘×•×“×”:**
1. **×ž×©×ª×ž×©** ×©×•×œ×— ×‘×§×©×” ×œ×¦×™×•×“ ×¢× ×¤×¨×˜×™× ××™×©×™×™×
2. **×ž× ×”×œ** ×ž×§×‘×œ ××ª ×”×‘×§×©×” ×•×¦×¨×™×š ×œ××©×¨/×œ×“×—×•×ª
3. **×˜×•×§×Ÿ** × ×•×¦×¨ ×¢× ×¤×§×™×¢×ª ×ª×•×§×£ (expires_at)
4. **×ž×©×ª×ž×©** ×ž×§×‘×œ ×§×™×©×•×¨ ×œ×˜×•×§×Ÿ ×‘×• ×ž×•×¦×’×™×:
   - ×§×•×“ ×¤×ª×™×—×ª ×”××¨×•×Ÿ (×× ×”×•×’×“×¨)
   - ×ž×™×§×•× ×ž×“×•×™×§ ×¢× ×”×•×¨××•×ª
   - ×ª×ž×•× ×” ×©×œ ×”××¨×•×Ÿ
   - ×›×¤×ª×•×¨ ××™×©×•×¨ ×œ×§×™×—×”

#### ×ª×›×•× ×•×ª ×”×˜×•×§×Ÿ:
- **×ª×•×§×£ ×ž×•×’×‘×œ**: ×”×˜×•×§×Ÿ ×¤×’ ×œ××—×¨ ×–×ž×Ÿ ×ž×•×’×“×¨
- **×”××¨×›×ª ×ª×•×§×£**: ×ž× ×”×œ ×™×›×•×œ ×œ×”××¨×™×š (10/20/30/60 ×“×§×•×ª)
- **×‘×™×˜×•×œ**: ×ž× ×”×œ ×™×›×•×œ ×œ×‘×˜×œ ×˜×•×§×Ÿ ×¤×¢×™×œ
- **×ž×¢×§×‘**: ×›×œ ×¤×¢×•×œ×” × ×¨×©×ž×ª ×‘-activity_log

#### ×”×’×“×¨×•×ª × ×•×¡×¤×•×ª ×‘×ž×¦×‘ ×‘×§×©×•×ª:
- **×§×•×“ ××¨×•×Ÿ** (cabinet_code): ×§×•×“ ×¡×•×“×™ ×©×ž×•×¦×’ ×¨×§ ×‘×˜×•×§×Ÿ
- **×“×¨×™×©×ª ×ž×–×”×” ×§×¨×™××”** (require_call_id): ×—×•×‘×” ×œ×ž×©×ª×ž×© ×œ×ž×œ× ×ž×–×”×” ×§×¨×™××”

---

### 2. **×”×“×¨×›×ª ×ž×™×§×•× ×ž×©×•×¤×¨×ª** ðŸ“

#### ×©×“×•×ª ×ž×™×§×•× ×ž×•×¤×¨×“×™×:
1. **×ž×™×§×•× ×‘×“×£ ×¨××©×™** (`location_url`):
   - ×ž×•×¦×’ ×œ×›×œ ×”×ž×©×ª×ž×©×™× ×‘×›×¨×˜×™×¡ ×”×¢×™×¨
   - ××•×¤×¦×™×•× ×œ×™ - × ×™×ª×Ÿ ×œ×”×©××™×¨ ×¨×™×§ ×œ×”×¡×ª×¨×”

2. **×ž×™×§×•× ×‘×˜×•×§×Ÿ** (`token_location_url`):
   - ×ž×•×¦×’ ×¨×§ ×œ×ž×™ ×©×§×™×‘×œ ×˜×•×§×Ÿ ×ž××•×©×¨
   - ×ž××¤×©×¨ ×œ×”×¡×ª×™×¨ ×ž×™×§×•× ×ž×“×•×™×§ ×ž×”×¦×™×‘×•×¨ ×”×¨×—×‘

#### ×”×•×¨××•×ª ×˜×§×¡×˜ (`location_description`):
- ×©×“×” ×˜×§×¡×˜ ×—×•×¤×©×™ ×œ×”×•×¨××•×ª ×ž×¦×™××ª ×”××¨×•×Ÿ
- ×œ×“×•×’×ž×”: "×”××¨×•×Ÿ × ×ž×¦× ×‘×›× ×™×¡×” ×”×¨××©×™×ª, ×œ×™×“ ×“×œ×¤×§ ×”×§×‘×œ×”..."
- ×ž×•×¦×’ ×‘×˜×•×§×Ÿ ×‘×œ×‘×“

#### ×ª×ž×•× ×ª ×ž×™×§×•× (`location_image_url`):
- ×§×™×©×•×¨ ×œ×ª×ž×•× ×” ×©×œ ×”××¨×•×Ÿ ××• ×”×ž×™×§×•×
- ×ž×•×¦×’ ×‘×˜×•×§×Ÿ ×‘×œ×‘×“
- ×¢×•×–×¨ ×œ×ž×©×ª×ž×©×™× ×œ×ž×¦×•× ××ª ×”××¨×•×Ÿ ×‘×§×œ×•×ª

---

### 3. **× ×™×”×•×œ ×˜×•×§× ×™× ×ž×ª×§×“×** â±ï¸

#### ×”××¨×›×ª ×ª×•×§×£ ×˜×•×§×Ÿ:
- ×›×¤×ª×•×¨×™× ×ž×”×™×¨×™×: **+10 ×“×§'**, **+20 ×“×§'**, **+30 ×“×§'**, **+60 ×“×§'**
- ×–×ž×™×Ÿ ×¨×§ ×œ×˜×•×§× ×™× ×¤×¢×™×œ×™× ×©×˜×¨× ×¤×’×•
- × ×¨×©× ×‘-activity_log
- ×ž×ª××™× ×œ×ž×¦×‘×™× ×‘×”× ×”×ž×©×ª×ž×© ×ž××—×¨

#### ×‘×™×˜×•×œ ×˜×•×§×Ÿ:
- ×›×¤×ª×•×¨ **"ðŸ”’ ×‘×˜×œ ×˜×•×§×Ÿ"** ×œ×˜×•×§× ×™× ×¤×¢×™×œ×™×
- × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×¡×™×‘×ª ×‘×™×˜×•×œ
- ×ž×©× ×” ××ª ×”×¡×˜×˜×•×¡ ×œ-`cancelled`
- ×ž×ª××™× ×œ×ž×¦×‘×™× ×©×”×ž×©×ª×ž×© ×‘×™×˜×œ ××• ×œ× ×”×’×™×¢

---

### 4. **×ž×ž×©×§ ×ž× ×”×œ ×ž×©×•×¤×¨** ðŸŽ¯

#### ×ª×’ ×‘×§×©×•×ª ×ž×ž×ª×™× ×•×ª:
- **×ª×’ ××“×•× ×ž×”×‘×”×‘** ×ž×•×¦×’ ×¢×œ ×˜××‘ "×‘×§×©×•×ª"
- ×ž×¦×™×’ ××ª ×ž×¡×¤×¨ ×”×‘×§×©×•×ª ×”×ž×ž×ª×™× ×•×ª ×œ××™×©×•×¨
- **×¨×¢× ×•×Ÿ ××•×˜×•×ž×˜×™** ×›×œ 15 ×©× ×™×•×ª
- ×ž×¢×•×“×›×Ÿ ×ž×™×“ ×œ××—×¨ ×›×œ ×¤×¢×•×œ×” (××™×©×•×¨/×“×—×™×™×”/×”××¨×›×”/×‘×™×˜×•×œ)

#### ×›×¤×ª×•×¨ ×”×¢×ª×§×ª ×§×™×©×•×¨:
- ×‘×“×™××œ×•×’ ××™×©×•×¨ ×‘×§×©×”
- ×›×¤×ª×•×¨ **"ðŸ“‹ ×”×¢×ª×§ ×§×™×©×•×¨"** ×œ×™×“ ×›×¤×ª×•×¨ "×“×œ×’"
- ×ž×¢×ª×™×§ ××ª ×§×™×©×•×¨ ×”×˜×•×§×Ÿ ×œ×œ×•×—
- ×ž××¤×©×¨ ×œ×ž× ×”×œ ×œ×©×œ×•×— ××ª ×”×§×™×©×•×¨ ×“×¨×š ×¢×¨×•×¦×™× ×©×•× ×™×

#### ×¨×¢× ×•×Ÿ ××•×˜×•×ž×˜×™:
- ×ž×¡×¤×¨ ×”×‘×§×©×•×ª ×”×ž×ž×ª×™× ×•×ª ×ž×ª×¢×“×›×Ÿ ×›×œ 15 ×©× ×™×•×ª
- ×œ× ×¦×¨×™×š ×œ×¨×¢× ×Ÿ ××ª ×”×“×£ ×™×“× ×™×ª
- ×ª×ž×™×“ ×™×•×“×¢ ×›×ž×” ×‘×§×©×•×ª ×ž×ž×ª×™× ×•×ª

---

## ðŸ”§ ×¢×“×›×•× ×™× ×˜×›× ×™×™×

### API Endpoints ×—×“×©×™×:

#### 1. `/api/requests/extend-token` (POST)
×”××¨×›×ª ×ª×•×§×£ ×˜×•×§×Ÿ ×¤×¢×™×œ

**Body:**
```json
{
  "requestId": "uuid",
  "minutesToAdd": 10,
  "managerName": "×©× ×ž× ×”×œ"
}
```

#### 2. `/api/requests/cancel-token` (POST)
×‘×™×˜×•×œ ×˜×•×§×Ÿ ×¤×¢×™×œ

**Body:**
```json
{
  "requestId": "uuid",
  "managerName": "×©× ×ž× ×”×œ",
  "reason": "×¡×™×‘×ª ×‘×™×˜×•×œ (××•×¤×¦×™×•× ×œ×™)"
}
```

### ×©×“×•×ª ×—×“×©×™× ×‘-cities:

```sql
ALTER TABLE cities
ADD COLUMN IF NOT EXISTS token_location_url TEXT;

ALTER TABLE cities
ADD COLUMN IF NOT EXISTS location_description TEXT;

ALTER TABLE cities
ADD COLUMN IF NOT EXISTS location_image_url TEXT;
```

---

## ðŸ“Š ×ª×¨×©×™× ×–×¨×™×ž×” - ×ž×¦×‘ ×‘×§×©×•×ª

```
×ž×©×ª×ž×©                     ×ž× ×”×œ                      ×ž×¢×¨×›×ª
   |                         |                          |
   |---> ×©×œ×™×—×ª ×‘×§×©×” -------->|                          |
   |                         |                          |
   |                         |---> ××™×©×•×¨/×“×—×™×™×” -------->|
   |                         |                          |
   |<--- ×§×™×©×•×¨ ×˜×•×§×Ÿ ---------|----- ×™×¦×™×¨×ª ×˜×•×§×Ÿ ---------|
   |                         |                          |
   |---> ×¤×ª×™×—×ª ×˜×•×§×Ÿ -------->|                          |
   |     (×¨×•××” ×§×•×“+×ž×™×§×•×)    |                          |
   |                         |                          |
   |     [××™×©×•×¨ ×œ×§×™×—×”] ----->|                          |
   |                         |                          |
   |                         |<--- ×¢×“×›×•×Ÿ ×ž×œ××™ ----------|
```

---

## ðŸŽ¨ ×©×™×¤×•×¨×™ UX

### ×œ×¤× ×™:
- âŒ ×ž×©×ª×ž×© ×œ× ×™×›×•×œ ×œ×¨××•×ª ×”×•×¨××•×ª ×ž×™×§×•× ×ž×¤×•×¨×˜×•×ª
- âŒ ×ž× ×”×œ ×œ× ×™×›×•×œ ×œ×”××¨×™×š ×˜×•×§×Ÿ
- âŒ ××™×Ÿ ×”×ª×¨××” ×¢×œ ×‘×§×©×•×ª ×—×“×©×•×ª
- âŒ ×§×©×” ×œ×”×¢×ª×™×§ ×§×™×©×•×¨ ×˜×•×§×Ÿ

### ××—×¨×™:
- âœ… ×ž×©×ª×ž×© ×ž×§×‘×œ ×”×•×¨××•×ª ×˜×§×¡×˜ + ×ª×ž×•× ×”
- âœ… ×ž× ×”×œ ×™×›×•×œ ×œ×”××¨×™×š/×œ×‘×˜×œ ×˜×•×§× ×™×
- âœ… ×ª×’ ××“×•× ×ž×¨××” ×›×ž×” ×‘×§×©×•×ª ×ž×ž×ª×™× ×•×ª
- âœ… ×›×¤×ª×•×¨ ×”×¢×ª×§×” ×ž×”×™×¨ ×‘×“×™××œ×•×’

---

## ðŸ’¡ ×ž×§×¨×™ ×©×™×ž×•×©

### ×ž×§×¨×” 1: ×”×©××œ×” ×¢× ×ž×™×§×•× ×ž×•×¡×ª×¨
**×‘×¢×™×”**: ×œ× ×¨×•×¦×™× ×©×›×•×œ× ×™×¨××• ××ª ×”×ž×™×§×•× ×”×ž×“×•×™×§ ×©×œ ×”××¨×•×Ÿ
**×¤×ª×¨×•×Ÿ**:
- ×”×©××¨ `location_url` ×¨×™×§ (×œ× ×™×•×¦×’ ×‘×“×£ ×¨××©×™)
- ×ž×œ× `token_location_url` (×™×•×¦×’ ×¨×§ ×œ×ž×™ ×©×§×™×‘×œ ×˜×•×§×Ÿ)

### ×ž×§×¨×” 2: ×ž×©×ª×ž×© ×ž××—×¨
**×‘×¢×™×”**: ×ž×©×ª×ž×© ×§×™×‘×œ ×˜×•×§×Ÿ ×œ-30 ×“×§×•×ª ××‘×œ ×ž××—×¨
**×¤×ª×¨×•×Ÿ**: ×ž× ×”×œ ×œ×•×—×¥ ×¢×œ **"+20 ×“×§'"** ×œ×”××¨×›×ª ×ª×•×§×£

### ×ž×§×¨×” 3: ×ž×©×ª×ž×© ×‘×™×˜×œ
**×‘×¢×™×”**: ×ž×©×ª×ž×© ××ž×¨ ×©×”×•× ×œ× ×ž×’×™×¢ ××‘×œ ×”×˜×•×§×Ÿ ×¢×“×™×™×Ÿ ×¤×¢×™×œ
**×¤×ª×¨×•×Ÿ**: ×ž× ×”×œ ×œ×•×—×¥ ×¢×œ **"ðŸ”’ ×‘×˜×œ ×˜×•×§×Ÿ"** ×¢× ×¡×™×‘×”

### ×ž×§×¨×” 4: ××¨×•×Ÿ ×§×©×” ×œ×ž×¦×™××”
**×‘×¢×™×”**: ×ž×©×ª×ž×©×™× ×ž×ª×§×©×™× ×œ×ž×¦×•× ××ª ×”××¨×•×Ÿ
**×¤×ª×¨×•×Ÿ**:
- ×ž×œ× `location_description` ×¢× ×”×•×¨××•×ª ×ž×¤×•×¨×˜×•×ª
- ×”×•×¡×£ ×ª×ž×•× ×” ×‘-`location_image_url`

---

## ðŸš€ ××™×š ×œ×¢×‘×•×¨ ×œ×ž×¦×‘ ×‘×§×©×•×ª?

### ×‘×ž×¢×¨×›×ª ×ž× ×”×œ:

1. ×›× ×¡ ×œ**×”×’×“×¨×•×ª** (âš™ï¸)
2. ×ž×¦× ××ª **"×ž×¦×‘ ×¤×¢×•×œ×” ×©×œ ×”×ž×¢×¨×›×ª"**
3. ×œ×—×¥ ×¢×œ **"×ž×¦×‘ ×‘×§×©×•×ª"**
4. ××©×¨ ××ª ×”×ž×¢×‘×¨
5. ×”×’×“×¨:
   - **×§×•×“ ××¨×•×Ÿ** (××•×¤×¦×™×•× ×œ×™)
   - **×“×¨×™×©×ª ×ž×–×”×” ×§×¨×™××”** (ON/OFF)

### ×ž×” ×§×•×¨×” ××—×¨×™ ×”×ž×¢×‘×¨?

- âœ… ×˜××‘ **"×‘×§×©×•×ª"** ×ž×•×¤×™×¢ ×‘× ×™×•×•×˜
- âœ… ×ž×©×ª×ž×©×™× ×©×•×œ×—×™× ×‘×§×©×•×ª ×‘×ž×§×•× ×”×©××œ×” ×™×©×™×¨×”
- âœ… ×ž× ×”×œ ×ž×§×‘×œ ×”×ª×¨××•×ª ×¢×œ ×‘×§×©×•×ª ×—×“×©×•×ª
- âœ… ×ª×”×œ×™×š ××™×©×•×¨/×“×—×™×™×” ×¤×¢×™×œ

---

## ðŸ“š ×§×‘×¦×™× ×©×¢×•×“×›× ×•

### Frontend:
- `src/app/request/[token]/page.tsx` - ×¢×ž×•×“ ×”×˜×•×§×Ÿ ×¢× ×”×ž×™×“×¢ ×”×—×“×©
- `src/components/RequestsTab.tsx` - × ×™×”×•×œ ×‘×§×©×•×ª ×¢× ×›×¤×ª×•×¨×™× ×—×“×©×™×
- `src/app/city/[cityId]/admin/page.tsx` - ×ª×’ ×‘×§×©×•×ª ×ž×ž×ª×™× ×•×ª

### Backend:
- `src/app/api/requests/extend-token/route.ts` - ×”××¨×›×ª ×˜×•×§×Ÿ
- `src/app/api/requests/cancel-token/route.ts` - ×‘×™×˜×•×œ ×˜×•×§×Ÿ
- `src/app/api/city/update-details/route.ts` - ×ª×ž×™×›×” ×‘×©×“×•×ª ×—×“×©×™×

### Database:
- `add-token-location-field.sql` - ×©×“×” ×ž×™×§×•× ×œ×˜×•×§×Ÿ
- `add-location-description-and-image.sql` - ×ª×™××•×¨ ×•×ª×ž×•× ×”

### Types:
- `src/types/index.ts` - ×¢×“×›×•×Ÿ ×ž×ž×©×§×™×

---

## âš ï¸ ×©×™× ×•×™×™× ×©×•×‘×¨×™× (Breaking Changes)

**××™×Ÿ!** ×›×œ ×”×©×™× ×•×™×™× ××—×•×¨×”-×ª×•××ž×™× (backward compatible).

- ×¢×¨×™× ×§×™×™×ž×•×ª ×ž×ž×©×™×›×•×ª ×œ×¢×‘×•×“ ×‘×ž×¦×‘ ×”×©××œ×” ×™×©×™×¨×”
- ×©×“×•×ª ×—×“×©×™× ×”× ××•×¤×¦×™×•× ×œ×™×™×
- × ×™×ª×Ÿ ×œ×¢×‘×•×¨ ×œ×ž×¦×‘ ×‘×§×©×•×ª ×‘×›×œ ×¢×ª

---

## ðŸ“ž ×ª×ž×™×›×” ×•×¡×™×•×¢

×× ×™×© ×©××œ×•×ª ××• ×‘×¢×™×•×ª:
1. ×‘×“×•×§ ××ª ×”×ž×“×¨×™×›×™× ×”×ž×¢×•×“×›× ×™×
2. × ×¡×” ×œ×¨×¢× ×Ÿ ××ª ×”×“×£
3. ×¦×•×¨ ×§×©×¨ ×¢× ×”×ª×ž×™×›×” ×”×˜×›× ×™×ª

---

**ðŸŽ‰ ×ª×•×“×” ×©××ª× ×ž×©×ª×ž×©×™× ×‘×ž×¢×¨×›×ª ××¨×•×Ÿ ×¦×™×•×“ ×™×“×™×“×™×!**

×’×¨×¡×” 3.0 - × ×•×‘×ž×‘×¨ 2024
