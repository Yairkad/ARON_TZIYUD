# ğŸ”§ ×”×•×¨××•×ª ×”×¨×¦×ª Migrations ×‘-Supabase

## âš ï¸ ×‘×¢×™×”: ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ××—×•×–×•×ª

×× ××ª×” ××§×‘×œ ×©×’×™××” ×‘×¢×ª × ×™×¡×™×•×Ÿ ×œ×”×•×¡×™×£ ××—×•×– ×—×“×©, ×¡×‘×™×¨ ×œ×”× ×™×— ×©×˜×‘×œ×ª `districts` ×¢×“×™×™×Ÿ ×œ× ×§×™×™××ª ×‘××¡×“ ×”× ×ª×•× ×™×.

## âœ… ×¤×ª×¨×•×Ÿ: ×”×¨×¦×ª Migration

×™×© ×œ×”×¨×™×¥ ××ª ×”-migration ×©×™×•×¦×¨ ××ª ×˜×‘×œ×ª ×”××—×•×–×•×ª ×‘-Supabase:

### ×©×œ×‘ 1: ×›× ×™×¡×” ×œ-Supabase Dashboard
1. ×”×™×›× ×¡ ×œ-[Supabase Dashboard](https://supabase.com/dashboard)
2. ×‘×—×¨ ××ª ×”×¤×¨×•×™×§×˜ ×©×œ×š (ARON_TZIYUD)

### ×©×œ×‘ 2: ×¤×ª×™×—×ª SQL Editor
1. ×‘×ª×¤×¨×™×˜ ×”×¦×“, ×œ×—×¥ ×¢×œ **"SQL Editor"** (âš¡ ××™×™×§×•×Ÿ ×‘×¨×§)
2. ×œ×—×¥ ×¢×œ **"New query"** (×©××™×œ×ª×” ×—×“×©×”)

### ×©×œ×‘ 3: ×”×¨×¦×ª ×”-Migration
1. ×”×¢×ª×§ ××ª ×›×œ ×”×ª×•×›×Ÿ ××”×§×•×‘×¥:
   ```
   supabase/migrations/20251212_create_districts_table.sql
   ```

2. ×”×“×‘×§ ××ª ×”×ª×•×›×Ÿ ×‘-SQL Editor

3. ×œ×—×¥ ×¢×œ **"Run"** (F5) ××• ×¢×œ ×”×›×¤×ª×•×¨ â–¶ï¸

### ×©×œ×‘ 4: ××™××•×ª
×œ××—×¨ ×”×¨×¦×ª ×”-migration, ×××ª ×©×”×˜×‘×œ×” × ×•×¦×¨×”:

```sql
SELECT * FROM districts;
```

×××•×¨×™× ×œ×”×•×¤×™×¢ 6 ××—×•×–×•×ª ×‘×¨×™×¨×ª ××—×“×œ:
- ×™×¨×•×©×œ×™× (××“×•×)
- ×¦×¤×•×Ÿ (×™×¨×•×§)
- ××¨×›×– (×›×—×•×œ)
- ×“×¨×•× (×›×ª×•×)
- ×—×™×¤×” (×¡×’×•×œ)
- ×ª×œ ××‘×™×‘ (×•×¨×•×“)

---

## ğŸ“‹ ×¨×©×™××ª ×›×œ ×”-Migrations

×œ×”×œ×Ÿ ×›×œ ×”-migrations ×©×¦×¨×™×›×™× ×œ×”×™×•×ª ××•×¨×¦×™× ×‘×¡×“×¨:

### 1. Districts Table (××—×•×–×•×ª)
**×§×•×‘×¥:** `supabase/migrations/20251212_create_districts_table.sql`

**××” ×–×” ×¢×•×©×”:**
- ×™×•×¦×¨ ×˜×‘×œ×ª `districts` ×œ× ×™×”×•×œ ××—×•×–×•×ª
- ××•×¡×™×£ ××™×œ×•×¦×™ ×ª×§×™× ×•×ª (hex color validation)
- ×™×•×¦×¨ foreign key ×-`wheel_stations` ×œ-`districts`
- ××•×¡×™×£ 6 ××—×•×–×•×ª ×‘×¨×™×¨×ª ××—×“×œ
- ××’×“×™×¨ RLS policies

**××™×š ×œ×”×¨×™×¥:** ×”×¢×ª×§ ×•×”×“×‘×§ ××ª ×›×œ ×”×ª×•×›×Ÿ ×‘-SQL Editor

---

### 2. Wheel Temporary Unavailable (×œ× ×–××™×Ÿ ×–×× ×™×ª)
**×§×•×‘×¥:** `supabase/migrations/20251212_wheel_temporary_unavailable.sql`

**××” ×–×” ×¢×•×©×”:**
- ××•×¡×™×£ ×©×“×•×ª ×œ×¡×™××•×Ÿ ×’×œ×’×œ×™× ×›×œ× ×–××™× ×™× ×–×× ×™×ª
- ×©×“×•×ª: `temporarily_unavailable`, `unavailable_reason`, `unavailable_notes`, `unavailable_since`, `unavailable_by_manager_id`

---

### 3. Add District to Stations (×”×•×¡×¤×ª ××—×•×– ×œ×ª×—× ×•×ª)
**×§×•×‘×¥:** `supabase/migrations/20251212_add_district_to_stations.sql`

**××” ×–×” ×¢×•×©×”:**
- ××•×¡×™×£ ×©×“×” `district` ×œ×˜×‘×œ×ª `wheel_stations`
- ×™×•×¦×¨ ××™× ×“×§×¡ ×œ×¡×™× ×•×Ÿ ××”×™×¨ ×œ×¤×™ ××—×•×–

âš ï¸ **×©×™× ×œ×‘:** ×”-migration ×”×–×” ××•×—×œ×£ ×¢×œ ×™×“×™ `20251212_create_districts_table.sql` ×©×™×•×¦×¨ ××ª ×”-foreign key.

---

## ğŸ” ×‘×“×™×§×ª ×‘×¢×™×•×ª

### ×‘×¢×™×”: "relation districts does not exist"
**×¤×ª×¨×•×Ÿ:** ×”×¨×¥ ××ª migration `20251212_create_districts_table.sql`

### ×‘×¢×™×”: "foreign key constraint failed"
**×¤×ª×¨×•×Ÿ:** ×•×•×“× ×©×”-`district` code ×©××ª×” ×× ×¡×” ×œ×”×©×ª××© ×‘×• ×§×™×™× ×‘×˜×‘×œ×ª `districts`

### ×‘×¢×™×”: "duplicate key value violates unique constraint"
**×¤×ª×¨×•×Ÿ:** ×× × ×™×¡×™×ª ×œ×”×¨×™×¥ ××ª ×”-migration ×¤×¢××™×™×, ×–×” ×‘×¡×“×¨ - ×”×©×•×¨×” `ON CONFLICT (code) DO NOTHING` ××•× ×¢×ª ×©×’×™××•×ª.

---

## ğŸ“ ×¦×¨×™×š ×¢×–×¨×”?

×× ××ª×” × ×ª×§×œ ×‘×‘×¢×™×•×ª:
1. ×‘×“×•×§ ××ª ×”-Logs ×‘-Supabase Dashboard
2. ×•×“× ×©×™×© ×œ×š ×”×¨×©××•×ª Admin
3. × ×¡×” ×œ×”×¨×™×¥ ××ª ×”-migrations ××—×“ ××—×¨×™ ×”×©× ×™
4. ×× ××©×”×• ×œ× ×¢×•×‘×“, ×¤× ×” ×œ×ª××™×›×”

---

**×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:** 12/12/2024
**×’×¨×¡×”:** 2.0.8
