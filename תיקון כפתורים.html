<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×¦×™×•×“ ××•×©××œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; direction: rtl; background: #f8fafc; }
        button { cursor: pointer; border: none; font-family: inherit; transition: 0.2s; }
        input, select { font-family: inherit; width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; }
        input:focus, select:focus { outline: none; border-color: #4f46e5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        .admin-box { position: fixed; top: 1rem; left: 1rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: 250px; z-index: 50; }
        .admin-box input { margin-bottom: 0.5rem; font-size: 14px; padding: 0.5rem; }
        .admin-box button { width: 100%; padding: 0.5rem; background: #4f46e5; color: white; border-radius: 4px; }
        .tabs { display: flex; gap: 1rem; margin-top: 18rem; margin-bottom: 1rem; }
        .tab-btn { flex: 1; padding: 1rem; border-radius: 8px; font-weight: bold; font-size: 16px; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .tab-btn.active { background: #16a34a; color: white; }
        .tab-btn.blue { background: #2563eb; }
        .content { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #333; }
        .submit-btn { width: 100%; padding: 1rem; font-size: 16px; font-weight: bold; color: white; border-radius: 4px; }
        .green { background: #16a34a; }
        .blue { background: #2563eb; }
        .submit-btn:hover { opacity: 0.9; }
        .message { padding: 1rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-weight: bold; }
        .success { background: #dcfce7; color: #166534; }
        .error { background: #fee2e2; color: #991b1b; }
        .item-box { background: #eff6ff; padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .item-box button { padding: 0.5rem 1rem; background: #16a34a; color: white; border-radius: 4px; }
        .admin-panel { margin-top: 2rem; }
        .grid { display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem; }
        .inventory { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 500px; overflow-y: auto; }
        .inventory-item { display: flex; justify-content: space-between; padding: 0.75rem; background: #f8fafc; margin-bottom: 0.5rem; border-radius: 4px; }
        .alerts { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 500px; overflow-y: auto; }
        .alert-item { background: #fefce8; border-left: 4px solid #facc15; padding: 1rem; margin-bottom: 0.5rem; border-radius: 4px; }
        .alert-item.read { background: #f8fafc; border-left-color: #cbd5e1; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { text-align: right; padding: 0.75rem; border-bottom: 2px solid #ddd; background: #f8fafc; }
        .table td { text-align: right; padding: 0.75rem; border-bottom: 1px solid #eee; }
        .export-btn { background: #16a34a; color: white; padding: 0.75rem 1.5rem; border-radius: 4px; }
        .logout-btn { background: #dc2626; color: white; padding: 0.75rem 1.5rem; border-radius: 4px; }
        .btn-group { display: flex; gap: 1rem; }
        .section { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        @media (max-width: 768px) { 
            .grid { grid-template-columns: 1fr; } 
            .tabs { flex-direction: column; margin-top: 1rem; }
            .admin-box { position: relative; width: 100%; left: 0; top: 0; margin-bottom: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ×›× ×™×¡×” ×× ×”×œ -->
        <div class="admin-box" id="adminBox">
            <h3 style="margin-bottom: 0.5rem; font-size: 14px;">ğŸ” ×›× ×™×¡×” ×× ×”×œ</h3>
            <input type="password" id="adminCode" placeholder="×§×•×“ ×’×™×©×”" onkeypress="if(event.key==='Enter') loginAdmin()">
            <button onclick="loginAdmin()">×›× ×¡</button>
        </div>

        <!-- ××¦×‘ ××©×ª××© -->
        <div id="userMode">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('borrow')">ğŸ“¦ ×œ×§×™×—×ª ×¦×™×•×“</button>
                <button class="tab-btn blue" onclick="switchTab('return')">ğŸ”„ ×”×—×–×¨×ª ×¦×™×•×“</button>
            </div>

            <div id="borrowTab" class="content">
                <h2 style="margin-bottom: 1.5rem;">ğŸ“¦ ×œ×§×™×—×ª ×¦×™×•×“</h2>
                <div id="borrowMsg" class="message" style="display:none;"></div>
                <div class="form-group">
                    <label>×©×</label>
                    <input type="text" id="borrowName" placeholder="×”×–×Ÿ ××ª ×©××š">
                </div>
                <div class="form-group">
                    <label>×˜×œ×¤×•×Ÿ</label>
                    <input type="tel" id="borrowPhone" placeholder="×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ">
                </div>
                <div class="form-group">
                    <label>×‘×—×¨ ×¦×™×•×“</label>
                    <select id="borrowItem">
                        <option value="">-- ×‘×—×¨ --</option>
                    </select>
                </div>
                <button class="submit-btn green" onclick="borrowItem()">×§×— ×¦×™×•×“</button>
            </div>

            <div id="returnTab" class="content" style="display:none;">
                <h2 style="margin-bottom: 1.5rem;">ğŸ”„ ×”×—×–×¨×ª ×¦×™×•×“</h2>
                <div id="returnMsg" class="message" style="display:none;"></div>
                <div class="form-group">
                    <label>×©×</label>
                    <input type="text" id="returnName" placeholder="×”×–×Ÿ ××ª ×©××š">
                </div>
                <div class="form-group">
                    <label>×˜×œ×¤×•×Ÿ</label>
                    <input type="tel" id="returnPhone" placeholder="×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ" onkeypress="if(event.key==='Enter') searchReturn()">
                </div>
                <button class="submit-btn blue" onclick="searchReturn()">×—×¤×© ×¤×¨×™×˜×™×</button>
                <div id="returnItems" style="margin-top: 1.5rem;"></div>
            </div>
        </div>

        <!-- ××¦×‘ ×× ×”×œ -->
        <div id="adminMode" style="display:none;" class="admin-panel">
            <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:2rem;">
                <h1>ğŸ“Š ×“×•×— × ×™×”×•×œ ×¦×™×•×“</h1>
                <div class="btn-group">
                    <button class="export-btn" onclick="exportExcel()">ğŸ“¥ ×™×™×¦×•× Excel</button>
                    <button class="logout-btn" onclick="logout()">ğŸšª ×™×¦×™××”</button>
                </div>
            </div>

            <div class="grid">
                <div class="inventory">
                    <h3 style="margin-bottom: 1rem;">ğŸ“¦ ××œ××™ × ×•×›×—×™</h3>
                    <div id="inventoryList"></div>
                    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #ddd;">
                        <h4 style="margin-bottom: 0.75rem; font-size: 14px;">×¢×“×›×Ÿ ××œ××™:</h4>
                        <select id="editItem" style="margin-bottom: 0.5rem;">
                            <option value="">-- ×‘×—×¨ ×¤×¨×™×˜ --</option>
                        </select>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <button onclick="changeQuantity(-1)" style="flex:1; padding: 0.5rem; background: #dc2626; color: white; border-radius: 4px;">-</button>
                            <input type="number" id="quantityInput" value="0" style="flex:1; padding: 0.5rem; text-align: center;">
                            <button onclick="changeQuantity(1)" style="flex:1; padding: 0.5rem; background: #16a34a; color: white; border-radius: 4px;">+</button>
                        </div>
                        <button onclick="updateQuantity()" style="width: 100%; padding: 0.5rem; background: #2563eb; color: white; border-radius: 4px; font-size: 12px;">×¢×“×›×Ÿ</button>
                    </div>
                </div>
                <div class="alerts">
                    <h3 style="margin-bottom: 1rem;">ğŸ”” ×”×ª×¨××•×ª (<span id="alertCount">0</span> ×—×“×©×•×ª)</h3>
                    <div id="alertsList"></div>
                </div>
            </div>

            <div class="section">
                <h3 style="margin-bottom: 1rem;">ğŸ“‹ ×”×™×¡×˜×•×¨×™×”</h3>
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>×©×</th>
                                <th>×˜×œ×¤×•×Ÿ</th>
                                <th>×¦×™×•×“</th>
                                <th>×ª××¨×™×š</th>
                                <th>×¡×˜×˜×•×¡</th>
                            </tr>
                        </thead>
                        <tbody id="historyTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h3 style="margin-bottom: 1rem;">âš™ï¸ × ×™×”×•×œ ×”×¢×¡×§×•×ª</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div>
                        <label>×©× ××ª× ×“×‘</label>
                        <input type="text" id="adminName" placeholder="×”×–×Ÿ ×©×">
                    </div>
                    <div>
                        <label>×˜×œ×¤×•×Ÿ</label>
                        <input type="tel" id="adminPhone" placeholder="×”×–×Ÿ ×˜×œ×¤×•×Ÿ">
                    </div>
                    <div>
                        <label>×‘×—×¨ ×¦×™×•×“</label>
                        <select id="adminItem">
                            <option value="">-- ×‘×—×¨ --</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button onclick="adminAddBorrow()" style="flex: 1; padding: 0.75rem; background: #16a34a; color: white; border-radius: 4px; font-weight: bold;">ğŸ“¥ ×”×•×¡×£ ×”×©××œ×”</button>
                    <button onclick="adminAddReturn()" style="flex: 1; padding: 0.75rem; background: #2563eb; color: white; border-radius: 4px; font-weight: bold;">ğŸ“¤ ×”×•×¡×£ ×”×—×–×¨×”</button>
                </div>
            </div>

            <div class="section">
                <h3 style="margin-bottom: 1rem;">â• ×”×•×¡×¤×ª ×¤×¨×™×˜ ×œ××œ××™</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div>
                        <label>×©× ×”×¤×¨×™×˜</label>
                        <input type="text" id="newItemName" placeholder="×”×–×Ÿ ×©× ×¤×¨×™×˜">
                    </div>
                    <div>
                        <label>×›××•×ª</label>
                        <input type="number" id="newItemQuantity" placeholder="×”×–×Ÿ ×›××•×ª" value="1" min="1">
                    </div>
                </div>
                <button onclick="addNewItem()" style="width: 100%; padding: 0.75rem; margin-top: 1rem; background: #16a34a; color: white; border-radius: 4px; font-weight: bold;">â• ×”×•×¡×£ ×¤×¨×™×˜</button>
            </div>

            <div class="section">
                <h3 style="margin-bottom: 1rem;">ğŸ—‘ï¸ ××—×™×§×ª ×¤×¨×™×˜ ××”××œ××™</h3>
                <div style="display: flex; gap: 1rem;">
                    <select id="deleteItem" style="flex: 1;">
                        <option value="">-- ×‘×—×¨ ×¤×¨×™×˜ ×œ××—×™×§×” --</option>
                    </select>
                    <button onclick="deleteItem()" style="padding: 0.75rem 1.5rem; background: #dc2626; color: white; border-radius: 4px; font-weight: bold;">ğŸ—‘ï¸ ××—×§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_CODE = '1234';
        let isAdmin = false;
        
        const equipment = [
            { id: 1, name: '×’\'×§ ×¢×’×œ×”', quantity: 1 },
            { id: 2, name: '×’\'×§ ××¡×¤×¨×™×™× ×¤×œ×•×¡ ×™×“×™×ª ×¨××¦\'×˜', quantity: 1 },
            { id: 3, name: '××ª×× ×’\'×§ ×œ×˜×¡×œ×”', quantity: 1 },
            { id: 4, name: '×™×“×™×ª ×›×•×— ××•× ×™×‘×¨×¡×œ×™×ª', quantity: 1 },
            { id: 5, name: '×‘×•×§×¡×•×ª ×œ××’× ×–×™×•×', quantity: 1 },
            { id: 6, name: '×‘×•×§×¡×•×ª ×œ×©×—×•×§×™×', quantity: 1 },
            { id: 7, name: '×‘×•×¨×’ ×¡×™×œ×™×§×•×Ÿ ×§×˜×Ÿ ×¤×œ×•×¡ ×’×“×•×œ', quantity: 1 },
            { id: 8, name: '×•× ×˜×™×œ×™×', quantity: 1 },
            { id: 9, name: '×¤×§×§ ×œ×¨×“×™××˜×•×¨', quantity: 1 },
            { id: 10, name: '×›×¤×¤×•×ª ×¢×‘×•×ª', quantity: 2 },
            { id: 11, name: '×¡×¤×¨×™×™ ×œ×¤× ×¦\'×¨', quantity: 1 },
            { id: 12, name: '×¡×¤×¨×™×™ ×©×™××•×Ÿ', quantity: 1 },
            { id: 13, name: '×¡×¤×¨×™×™ ×§×¨×‘×•×¨×˜×•×¨', quantity: 1 },
            { id: 14, name: '××¤×ª×— ××œ×Ÿ 12', quantity: 1 },
            { id: 15, name: '×§×•××¤×¨×¡×•×¨ ×§×˜×Ÿ', quantity: 1 },
            { id: 16, name: '×¢×¨×›×ª ×ª×•×œ×¢×™× ×›×¤×•×œ ×©×ª×™×™× ×¤×œ×•×¡ ×—×‘×™×œ×ª ×ª×•×œ×¢×™×', quantity: 1 },
            { id: 17, name: '××¦×‘×¢ ××›× ×™×ª ×©×ª×™ ××˜×¨', quantity: 1 },
            { id: 18, name: '×¢×¨×›×ª ×¤×ª×™×—×” + ×œ×•× ×•×§×œ×™×Ÿ × ×•×¡×£', quantity: 1 },
            { id: 19, name: '××©×•×œ×© ××–×”×¨×”', quantity: 1 },
        ];

        let borrowHistory = [];
        let readAlerts = new Set();

        function loginAdmin() {
            const code = document.getElementById('adminCode').value;
            if (code === ADMIN_CODE) {
                isAdmin = true;
                document.getElementById('userMode').style.display = 'none';
                document.getElementById('adminMode').style.display = 'block';
                document.getElementById('adminBox').style.display = 'none';
                document.getElementById('adminCode').value = '';
                updateAdmin();
            } else {
                alert('×§×•×“ ×’×™×©×” ×©×’×•×™');
            }
        }

        function logout() {
            isAdmin = false;
            document.getElementById('userMode').style.display = 'block';
            document.getElementById('adminMode').style.display = 'none';
            document.getElementById('adminBox').style.display = 'block';
            updateBorrowSelect();
        }

        function switchTab(tab) {
            document.getElementById('borrowTab').style.display = tab === 'borrow' ? 'block' : 'none';
            document.getElementById('returnTab').style.display = tab === 'return' ? 'block' : 'none';
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function updateBorrowSelect() {
            const select = document.getElementById('borrowItem');
            select.innerHTML = '<option value="">-- ×‘×—×¨ --</option>';
            equipment.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.quantity} ×–××™× ×™×)`;
                opt.disabled = item.quantity === 0;
                select.appendChild(opt);
            });
        }

        function showMessage(id, text, isSuccess) {
            const msg = document.getElementById(id);
            msg.textContent = text;
            msg.className = `message ${isSuccess ? 'success' : 'error'}`;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function borrowItem() {
            const name = document.getElementById('borrowName').value.trim();
            const phone = document.getElementById('borrowPhone').value.trim();
            const itemId = parseInt(document.getElementById('borrowItem').value);

            if (!name || !phone || !itemId) {
                showMessage('borrowMsg', '×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª', false);
                return;
            }

            const item = equipment.find(e => e.id === itemId);
            if (!item || item.quantity === 0) {
                showMessage('borrowMsg', '×”×¦×™×•×“ ××™× ×• ×–××™×Ÿ', false);
                return;
            }

            item.quantity--;
            borrowHistory.unshift({
                id: Date.now(),
                itemName: item.name,
                itemId: item.id,
                personName: name,
                phone: phone,
                borrowDate: new Date().toLocaleString('he-IL'),
                status: 'borrowed',
                read: false
            });

            document.getElementById('borrowName').value = '';
            document.getElementById('borrowPhone').value = '';
            document.getElementById('borrowItem').value = '';
            showMessage('borrowMsg', 'âœ… ×”×¦×™×•×“ × ×œ×§×— ×‘×”×¦×œ×—×”!', true);
            updateBorrowSelect();
            if (isAdmin) updateAdmin();
        }

        function searchReturn() {
            const name = document.getElementById('returnName').value.trim();
            const phone = document.getElementById('returnPhone').value.trim();

            if (!name || !phone) {
                showMessage('returnMsg', '×× × ×”×–×Ÿ ×©× ×•×˜×œ×¤×•×Ÿ', false);
                return;
            }

            const items = borrowHistory.filter(r => r.personName === name && r.phone === phone && r.status === 'borrowed');
            
            if (items.length === 0) {
                showMessage('returnMsg', '×œ× × ××¦××• ×¤×¨×™×˜×™× ××©××•×œ×™×', false);
                document.getElementById('returnItems').innerHTML = '';
                return;
            }

            let html = '<h3 style="margin-bottom: 1rem;">×”×¤×¨×™×˜×™× ×©×œ×š:</h3>';
            items.forEach(item => {
                html += `<div class="item-box">
                    <div>
                        <strong>${item.itemName}</strong><br>
                        <small>×œ×§×— ×‘: ${item.borrowDate}</small>
                    </div>
                    <button onclick="returnItem(${item.id})">×”×—×–×¨</button>
                </div>`;
            });
            document.getElementById('returnItems').innerHTML = html;
        }

        function returnItem(recordId) {
            const record = borrowHistory.find(r => r.id === recordId);
            if (!record) return;

            const item = equipment.find(e => e.id === record.itemId);
            if (item) item.quantity++;

            record.status = 'returned';
            document.getElementById('returnItems').innerHTML = '';
            document.getElementById('returnName').value = '';
            document.getElementById('returnPhone').value = '';
            showMessage('returnMsg', 'âœ… ×”×¦×™×•×“ ×”×•×—×–×¨ ×‘×”×¦×œ×—×”!', true);
            if (isAdmin) updateAdmin();
        }

        function updateAdmin() {
            // ××œ××™
            let invHtml = '';
            equipment.forEach(item => {
                const color = item.quantity > 0 ? '#dcfce7' : '#fee2e2';
                const textColor = item.quantity > 0 ? '#166534' : '#991b1b';
                invHtml += `<div class="inventory-item">
                    <span>${item.name}</span>
                    <span style="background: ${color}; color: ${textColor}; padding: 0.25rem 0.75rem; border-radius: 4px; font-weight: bold;">${item.quantity}</span>
                </div>`;
            });
            document.getElementById('inventoryList').innerHTML = invHtml;

            // ×¢×“×›×Ÿ dropdown ×œ×¢×¨×™×›×ª ××œ××™
            const editSelect = document.getElementById('editItem');
            editSelect.innerHTML = '<option value="">-- ×‘×—×¨ ×¤×¨×™×˜ --</option>';
            equipment.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.quantity})`;
                editSelect.appendChild(opt);
            });

            // ×¢×“×›×Ÿ dropdown ×œ× ×™×”×•×œ ×”×¢×¡×§×•×ª
            const adminSelect = document.getElementById('adminItem');
            adminSelect.innerHTML = '<option value="">-- ×‘×—×¨ --</option>';
            equipment.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.quantity} ×–××™× ×™×)`;
                opt.disabled = item.quantity === 0;
                adminSelect.appendChild(opt);
            });

            // ×¢×“×›×Ÿ dropdown ×œ××—×™×§×”
            updateDeleteSelect();

            // ×”×ª×¨××•×ª
            const unread = borrowHistory.filter(r => r.status === 'borrowed' && !readAlerts.has(r.id));
            document.getElementById('alertCount').textContent = unread.length;
            let alertsHtml = '';
            borrowHistory.filter(r => r.status === 'borrowed').slice(0, 10).forEach(r => {
                const isRead = readAlerts.has(r.id);
                alertsHtml += `<div class="alert-item ${isRead ? 'read' : ''}">
                    <p><strong>${r.personName} ×œ×§×— ${r.itemName}</strong></p>
                    <small>ğŸ“± ${r.phone} | â° ${r.borrowDate}</small>
                    ${!isRead ? `<button onclick="markRead(${r.id})" style="margin-top: 0.5rem; background: #2563eb; color: white; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 12px;">×§×¨×</button>` : ''}
                </div>`;
            });
            document.getElementById('alertsList').innerHTML = alertsHtml || '<p style="color: #999;">××™×Ÿ ×”×ª×¨××•×ª</p>';

            // ×”×™×¡×˜×•×¨×™×”
            let historyHtml = '';
            borrowHistory.slice(0, 20).forEach(r => {
                const status = r.status === 'borrowed' ? 'â³ ××•×©××œ' : 'âœ… ×”×•×—×–×¨';
                const statusColor = r.status === 'borrowed' ? '#fed7aa' : '#dcfce7';
                historyHtml += `<tr>
                    <td>${r.personName}</td>
                    <td>${r.phone}</td>
                    <td>${r.itemName}</td>
                    <td style="font-size: 12px;">${r.borrowDate}</td>
                    <td style="background: ${statusColor}; border-radius: 4px; text-align: center;">${status}</td>
                </tr>`;
            });
            document.getElementById('historyTable').innerHTML = historyHtml;
        }

        function changeQuantity(change) {
            const input = document.getElementById('quantityInput');
            input.value = Math.max(0, parseInt(input.value) + change);
        }

        function updateQuantity() {
            const itemId = parseInt(document.getElementById('editItem').value);
            const newQuantity = parseInt(document.getElementById('quantityInput').value);

            if (!itemId || newQuantity < 0) {
                alert('×‘×—×¨ ×¤×¨×™×˜ ×•×”×–×Ÿ ×›××•×ª ×ª×§×™× ×”');
                return;
            }

            const item = equipment.find(e => e.id === itemId);
            if (item) {
                item.quantity = newQuantity;
                document.getElementById('quantityInput').value = 0;
                document.getElementById('editItem').value = '';
                updateAdmin();
                alert('âœ… ×”××œ××™ ×¢×•×“×›×Ÿ');
            }
        }

        function adminAddBorrow() {
            const name = document.getElementById('adminName').value.trim();
            const phone = document.getElementById('adminPhone').value.trim();
            const itemId = parseInt(document.getElementById('adminItem').value);

            if (!name || !phone || !itemId) {
                alert('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }

            const item = equipment.find(e => e.id === itemId);
            if (!item || item.quantity === 0) {
                alert('×”×¦×™×•×“ ××™× ×• ×–××™×Ÿ');
                return;
            }

            item.quantity--;
            borrowHistory.unshift({
                id: Date.now(),
                itemName: item.name,
                itemId: item.id,
                personName: name,
                phone: phone,
                borrowDate: new Date().toLocaleString('he-IL'),
                status: 'borrowed',
                read: false
            });

            document.getElementById('adminName').value = '';
            document.getElementById('adminPhone').value = '';
            document.getElementById('adminItem').value = '';
            alert('âœ… ×”×©××œ×” × ×•×¡×¤×”');
            updateAdmin();
        }

        function adminAddReturn() {
            const name = document.getElementById('adminName').value.trim();
            const phone = document.getElementById('adminPhone').value.trim();

            if (!name || !phone) {
                alert('×× × ××œ× ×©× ×•×˜×œ×¤×•×Ÿ');
                return;
            }

            const record = borrowHistory.find(r => r.personName === name && r.phone === phone && r.status === 'borrowed');
            if (!record) {
                alert('×œ× × ××¦××” ×”×©××œ×” ×¤×¢×™×œ×” ×œ×©× ×•×˜×œ×¤×•×Ÿ ×–×”');
                return;
            }

            const item = equipment.find(e => e.id === record.itemId);
            if (item) item.quantity++;

            record.status = 'returned';
            document.getElementById('adminName').value = '';
            document.getElementById('adminPhone').value = '';
            alert('âœ… ×”×—×–×¨×” × ×•×¡×¤×”');
            updateAdmin();
        }

        function markRead(id) {
            readAlerts.add(id);
            updateAdmin();
        }

        function addNewItem() {
            const name = document.getElementById('newItemName').value.trim();
            const quantity = parseInt(document.getElementById('newItemQuantity').value);

            if (!name || quantity < 1) {
                alert('×× × ×”×–×Ÿ ×©× ×¤×¨×™×˜ ×•×›××•×ª ×ª×§×™× ×”');
                return;
            }

            const newId = Math.max(...equipment.map(e => e.id)) + 1;
            equipment.push({
                id: newId,
                name: name,
                quantity: quantity
            });

            document.getElementById('newItemName').value = '';
            document.getElementById('newItemQuantity').value = '1';
            alert('âœ… ×”×¤×¨×™×˜ × ×•×¡×£ ×‘×”×¦×œ×—×”');
            updateAdmin();
        }

        function deleteItem() {
            const itemId = parseInt(document.getElementById('deleteItem').value);
            
            if (!itemId) {
                alert('×× × ×‘×—×¨ ×¤×¨×™×˜ ×œ××—×™×§×”');
                return;
            }

            const item = equipment.find(e => e.id === itemId);
            const hasBorrowed = borrowHistory.some(r => r.itemId === itemId && r.status === 'borrowed');
            
            if (hasBorrowed) {
                alert('âš ï¸ ×œ× × ×™×ª×Ÿ ×œ××—×•×§ ×¤×¨×™×˜ ×©×™×© ×¢×œ×™×• ×”×©××œ×•×ª ×¤×¢×™×œ×•×ª');
                return;
            }

            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${item.name}"?`)) {
                const index = equipment.findIndex(e => e.id === itemId);
                equipment.splice(index, 1);
                document.getElementById('deleteItem').value = '';
                alert('âœ… ×”×¤×¨×™×˜ × ××—×§ ×‘×”×¦×œ×—×”');
                updateAdmin();
                updateDeleteSelect();
            }
        }

        function updateDeleteSelect() {
            const deleteSelect = document.getElementById('deleteItem');
            deleteSelect.innerHTML = '<option value="">-- ×‘×—×¨ ×¤×¨×™×˜ ×œ××—×™×§×” --</option>';
            equipment.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = item.name;
                deleteSelect.appendChild(opt);
            });
        }

        // Initialize
        updateBorrowSelect();
        
        // Add event listener for edit item selection
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('editItem').addEventListener('change', function() {
                const itemId = parseInt(this.value);
                if (itemId) {
                    const item = equipment.find(e => e.id === itemId);
                    if (item) {
                        document.getElementById('quantityInput').value = item.quantity;
                    }
                }
            });
        });
    </script>
</body>
</html>